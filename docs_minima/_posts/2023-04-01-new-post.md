---
layout: post
title: "Coalescent Theory in Python - Introduction"
date: 2023-04-01 10:23:29 +0000
categories: python genetics coalescent theory introduction
use_math: true
---

This week i had no particular magic happen at work, so I decided to begin transitioning some material i have previosuly hosted in jupyter notebooks to this blog. I will be posting a series of posts on the coalescent theory, which is a branch of probability theory that is used in population genetics. I wrote them while taking classes on the subject under [Dr. Jeffrey Jensen](http://jjensenlab.org/).

The series was motivated by wanting to combine two things i am interested in: genetics and programming, particularly python. While the package [msprime](https://msprime.readthedocs.io/en/stable/) is a great tool for simulating genetic data, I did not encounter python modules for the more basic aspects of coalescent theory. This repository attempted to fill that gap, and provide a reference for myself.

- In case that reference does exist, i figured it was still good practice, but please let me know.

Before we get into it though, some background on the coalescent theory. Feel free to skip to the next post if you are already familiar with the subject.

### Short introduction to coalescent theory

Coalescent theory is a branch of probability theory that is used in population genetics. It is used to calculate the probability of a given genealogy, given a set of parameters. Inversely, and more importantly, it can be used to infer important parameters of a population, such as the population size, the mutation rate, and the recombination rate, for a given genealogy. Methods of inference can be analytical, using math, or numerical, using simulations.

Some definitions.

#### Genes

In the context of coalescent theory, we think of genealogy from the perspective of a single gene.

Genes are the units of inheritance. They are the sequences of DNA that are passed from parent to offspring. Alleles are the different versions of a gene. For example, the gene for eye color can have two alleles, one for blue eyes, and one for brown eyes.

#### The Genealogy of a population

The genealogy of a population is a tree that describes the ancestry of a population. Each node in the tree represents a single gene, the root of the tree represents the most recent common ancestor of the population. The leaves of the tree represent the genes in the current population, e.g.

```
         1
      /     \
     2       3
    / \     / \
   4   5   6   7
  / \ / \ / \ / \
 8  9 10 11 12 13 14
```

One thing to consider going forward is that a tree may not include all present genes, and thus not all ancestors. It then consists of all common ancestors of a subset of modern genes up to the root, e.g.:

```
         1
      /    \
     x      3
    / \    / \
   x   x   x   x
  / \ / \ / \ / \
 8  x x x  12 x  14


           1
        /    \
       /      3
      /      / \
     8      12 14
```

#### The coalescent

The coalescent is the process by which two genes in a population merge into a single gene. Looking at the tree above you will notice that this is only possible going from the leaves to the root. This is an important concept to keep in mind: in coalescent theory, we are going backwards in time, from the present to the past.

With this in mind, we find that the probability of a coalescent event occuring in a given generation is given by $\frac{1}{2Ne}$, where $ Ne $ eis the population size.

#### Mutation

Mutation is the process by which a new allele is introduced into a population. The rate of new mutations is the probability of such an event, usually calculated by genereration. In the context of coalescent theory, we think of mutations as occuring against the tree above, such that as we traverse the tree (from the bottom up), the probability of a mutation occuring is given by the mutation rate, $\mu$, times the length of a branch in generations.

The probability of a mutation occuring in a given generation across a population is given by $\mu4Ne$, where $Ne$ is the population size.

### The coalescent process

Putting the above together, as we move up the tree one of two things can happen: a coalescent event, or a mutation event. In either case our state, the number of alleles in the case of a coalescent event, or the number of alleles plus the number of mutations in the case of a mutation event, changes.

The coalescent process is thus a stochastic process that describes the evolution of a population of individuals according to the following rules:

1. A coalescent event occurs between identical alleles with probability $\frac{1}{2Ne}$, where $Ne$ is the population size.
2. A mutation event occurs with probability $\mu2Ne$, where $Ne$ is the population size.

The coalescent process is a [Markov chain](https://brilliant.org/wiki/markov-chains/), which means that the probability of a given state depends only on the previous state. This is important because it allows us to calculate the probability of a given genealogy, given a set of parameters. This is done by calculating the probability of the genealogy, given the previous state, and multiplying it by the probability of the previous state, given the previous previous state, and so on, until we reach the root of the tree.
